---
title: "Template Literal Types ã®åŸºç¤ã¨ .joinãƒ».split ãƒ¡ã‚½ãƒƒãƒ‰ã®å‹å®šç¾©"
emoji: "ğŸ¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["typescript"]
published: true
---

# ã¯ã˜ã‚ã«

æœ¬è¨˜äº‹ã§ã¯ã€TypeScript 4.1 ã§è¿½åŠ äºˆå®šã® Template Literal Types ã®åŸºæœ¬çš„ãªæ©Ÿèƒ½ã‚’èª¬æ˜ã—ã€æ–‡å­—åˆ—çµåˆãƒ»åˆ†å‰²ã® `Array.prototype.join`ãƒ»`String.prototype.split` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‹æ¨è«–å¯èƒ½ãªé–¢æ•°ã¨ã—ã¦å‹å®šç¾©ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
Template Literal Types ã¯çµåˆãƒ»åˆ†å‰²ã‚’ç†è§£ã™ã‚Œã°ï¼˜å‰²ã¯ä½¿ã„ã“ãªã›ã‚‹ã¨æ€ã†ã®ã§ã€å‹ãƒ¬ãƒ™ãƒ«ã§æ–‡å­—åˆ—æ“ä½œã‚’ã—ãŸã„æ–¹ã«ã¯ãœã²ãŠèª­ã¿ã„ãŸã ããŸã„ã§ã™ã€‚

â˜… TypeScript ã§ã®å®Ÿè¡Œçµæœãƒ»å‹æ¨è«–çµæœã¯ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆå†…ã« `// ts: xxx` ã¨ã—ã¦è¡¨è¨˜ã—ã¾ã™ã€‚

# Template Literal Types ã¨ã¯

Template Literal Types ã«ã¤ã„ã¦ã®ç°¡å˜ãªç´¹ä»‹ã‚„é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã®è¨˜äº‹ã‚’ã”è¦§ãã ã•ã„ã€‚

> [TypeScript 4.1 ã® Template Literal Types ã‚’è©¦ã—ã¦ã¿ã‚ˆã† | Zenn](https://zenn.dev/lollipop_onl/articles/ef532c02fc51db20d832)

ã¾ãŸã€è©³ã—ã„ä»•æ§˜ã«ã¤ã„ã¦ã¯ Pull Request ã‚‚ä½µã›ã¦ã”è¦§ãã ã•ã„ã€‚

> [Template literal types and mapped type 'as' clauses by ahejlsberg Â· Pull Request #40336 Â· microsoft/TypeScript](https://github.com/microsoft/TypeScript/pull/40336)

# Template Literal Types ã§ã§ãã‚‹ã“ã¨

Template Literal Types ã¯ä¸»ã«æ–‡å­—åˆ—ã®çµåˆã¨æŠ½å‡ºã‚’è¡Œã†æ©Ÿèƒ½ã§ã™ã€‚

## æ–‡å­—åˆ—ã®çµåˆ

### åŸºæœ¬çš„ãªæ©Ÿèƒ½

æ–‡å­—åˆ—ã®çµåˆã§ã¯ JavaScript ã® Template Literal ã¨ã»ã¼åŒæ§˜ã®æ©Ÿèƒ½ãŒå‹ãƒ¬ãƒ™ãƒ«ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚

```ts
type Year = '2020';
type Month ='05';
type Date ='15';

type UTCFullDate = `${Year}-${Month}-${Date} UTC`;
// ts: '2020-05-15 UTC'
```

ã“ã®ã†ã¡ã€åˆ¥ã®å‹ã‚’åŸ‹ã‚è¾¼ã‚“ã§ã„ã‚‹ `${Type}` ã®éƒ¨åˆ†ã‚’ Placeholder ã¨å‘¼ã³ã¾ã™ã€‚

Placeholderã«æŒ‡å®šã§ãã‚‹å‹ã¯ `string`ãƒ»`number`ãƒ»`boolean`ãƒ»`bigint` ã®ã¿ã¨ãªã‚Šã¾ã™ã€‚
ãã‚Œä»¥å¤–ã®å‹ã‚„ `boolean` ä»¥å¤–ã®å‹ã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

```ts
type StrHello = `${'hello'}` // ts: 'hello'
type Str = `${string}` // ts: Template literal type argument 'string' is not literal type or a generic type.
type True = `${true}`; // ts: 'true'
type Bool = `${boolean}`; // ts: 'true' | 'false'
type Num100 = `${100}`; // ts: '100'
type Num = `${number}` // ts: Template literal type argument 'number' is not literal type or a generic type.
type BigInt100n = `${100n}`; // ts: '100'
type BigInt = `${bigint}`; // ts: Template literal type argument 'bigint' is not literal type or a generic type.
type Obj = `${Record<string, unknown>}` // ts: Type 'Record<string, unknown>' is not assignable to type 'string | number | bigint | boolean'.
```

ã¾ãŸã€ Placeholder å†…ã§å…±ç”¨ä½“å‹ã‚’ä½¿ç”¨ã—ãŸå ´åˆã€æ¨è«–ã•ã‚Œã‚‹å‹ã¯è€ƒãˆã‚‰ã‚Œã‚‹ã™ã¹ã¦ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãªã‚Šã¾ã™ã€‚

```ts
type UnionString = `${0|1}-${0|1}`;
// ts: '0-0' | '0-1' | '1-0' | '1-1'
```

ãªãŠã€é–¢æ•°ã®è¿”ã‚Šå€¤ãªã©ã§ Template Literal Types ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€è¿”å´å€¤ã®å‹ã ã‘ã§ãªãè¿”å´å€¤ãã®ã‚‚ã®ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚‚å¿…è¦ã«ãªã‚Šã¾ã™ã€‚
ã“ã‚Œã¯ã€Template Literal ã®å‹ãŒ `string` ã¨æ¨è«–ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã§ã™ã€‚

```ts
// NG
type EventName<T extends string> = `on${T}`;

function getEventName<T extends string>(name: T): EventName<T> {
  return `on${name}`;
  // ts: Type 'string' is not assignable to type '`on${T}`'.
}
```

```ts
// OK
type EventName<T extends string> = `on${T}`;

function getEventName<T extends string>(name: T): EventName<T> {
  return `on${name}` as EventName<T>;
}
```

### å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã®å¤‰æ›

Template Literal Types ã§ã¯ã€ã‚­ãƒ£ãƒ”ã‚¿ãƒ©ã‚¤ã‚ºï¼ˆå¤§æ–‡å­—ãƒ»å°æ–‡å­—ã®å¤‰æ›ï¼‰ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

ã‚­ãƒ£ãƒ”ã‚¿ãƒ©ã‚¤ã‚ºã¯ Placeholder ã§ä¿®é£¾å­ `uppercase`ãƒ»`lowercase`ãƒ»`capitalize`ãƒ»`uncapitalize` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§è¡¨ç¾ã§ãã¾ã™ã€‚

```ts
// ã™ã¹ã¦ã®æ–‡å­—ã‚’å¤§æ–‡å­—ã«ã™ã‚‹
type Uppercase = `${uppercase 'HelloWorld'}`; // ts: 'HELLOWORLD'
// ã™ã¹ã¦ã®æ–‡å­—ã‚’å°æ–‡å­—ã«ã™ã‚‹
type Lowercase = `${lowercase 'HelloWorld'}`; // ts: 'helloworld'
// æœ€åˆã®æ–‡å­—ã ã‘å¤§æ–‡å­—ã«ã™ã‚‹
type Capitalize = `${capitalize 'helloWorld'}`; // ts: 'HelloWorld'
// æœ€åˆã®æ–‡å­—ã ã‘å°æ–‡å­—ã«ã™ã‚‹
type Uncapitalize = `${uncapitalize 'HelloWorld'}`; // ts: 'helloWorld'
```

## æ–‡å­—åˆ—ã®æŠ½å‡º

æ–‡å­—åˆ—ã®æŠ½å‡ºã§ã¯ Conditional Types ã«ã‚ˆã‚‹å‹æ¨è«–ã¨ã®çµ„ã¿åˆã‚ã›ã§ã€æ–‡å­—åˆ—ã®ä¸€éƒ¨ã‚’æ–°ãŸãªå‹ã¨ã—ã¦æŠ½å‡ºã™ã‚‹æ©Ÿèƒ½ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚

æ¬¡ã®ä¾‹ã§ã¯ã€`YYYY-MM-DD` å½¢å¼ã®æ–‡å­—åˆ—ã‹ã‚‰ `YYYY`ãƒ»`MM`ãƒ»`DD` ã‚’ãã‚Œãã‚Œ `Y`ãƒ»`M`ãƒ»`D` ã®å‹ã¨ã—ã¦æŠ½å‡ºã—ã¦ã„ã¾ã™ã€‚

```ts
type FullDate = '2020-05-15';

type ParsedDate = FullDate extends `${infer Y}-${infer M}-${infer D}` ? [Y, M, D] : [];
// ts: ['2020', '05', '15']
```

Placeholder ã§ `infer T` ã®å½¢å¼ã§æ¨è«–ã•ã‚ŒãŸå‹ã‚’ä½¿ç”¨ã™ã‚‹å‹åã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

æ–‡å­—åˆ—ã®æŠ½å‡ºã¯æœ€çŸ­ãƒãƒƒãƒã®ãŸã‚ã€ä¸Šè¨˜ã®ä¾‹ã§ `'0-2020-05-15'` ã®ã‚ˆã†ãªå‹ã‚’æŒ‡å®šã™ã‚‹ã¨ `['0', '2020', '05-15']` ãŒè¿”ã•ã‚Œã¾ã™ã€‚
ï¼ˆæœ€å¾Œã® `infer D` ãŒæ®‹ã‚Šã®ã™ã¹ã¦ã«ãƒãƒƒãƒã—ã¦ã—ã¾ã†ï¼‰

ã¾ãŸã€Placeholder ã§å‹ã®åˆ¤å®šã¯ã§ããªã„ãŸã‚ã€å€¤ãŒæœŸå¾…ã—ãŸã‚‚ã®ã‹ã©ã†ã‹ã¯åˆ¥é€”åˆ¤å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

# å‹æ¨è«–å¯èƒ½ãª .join / .split ãƒ¡ã‚½ãƒƒãƒ‰ã®å‹å®šç¾©

Template Literal Types ã‚’ä½¿ã£ãŸå®Ÿç”¨ä¾‹ã¨ã—ã¦ã€ `Array.prototype.join`ãƒ»`String.prototype.split` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‹æ¨è«–å¯èƒ½ãªé–¢æ•°ã¨ã—ã¦å‹å®šç¾©ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## Array.prototype.join

JavaScript ã® `Array.prototype.join` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã€å®Ÿè¡Œçµæœã®å‹æ¨è«–ãŒå¯èƒ½ãªé–¢æ•°ã¨ã—ã¦å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚

```ts
type PlaceholderType = string | number | boolean | bigint;

type Join<T extends readonly PlaceholderType[], S extends string> =
  T extends readonly [infer P, ...infer R]
    ? P extends PlaceholderType
      ? [] extends R
        ? P
        : `${P}${S}${Join<R, S>}`
      : ''
    : [] extends T
      ? ''
      : string;

function join<T extends readonly PlaceholderType[], S extends string = ','>(
  array: T,
  separator?: S
) {
  return array.join(separator) as Join<T, S>;
}
```

```ts
join(['2020', '05', '15'] as const, '-'); // ts: '2020-05-15'
join(['Hello', 'world'] as const); // ts: 'Hello,World'
```

[Playground](https://www.typescriptlang.org/play?ts=4.1.0-beta#code/C4TwDgpgBACgNgQwMYQBYHs4BMICcAq40AvFAM7C4CWAdgOZQA+UNArgLYBGeTUn6mCAhq9OVOrWABuALAAoeaEhQAUuloAefFAgAPYBBpYyUXEKzoacELEQoM2PIUgBtALoAaKAGUd+w8bklLR0AHxQxPJQUNp6BkYmZggWVjYutABmPDBeAHT5mTwASm5R0VAA-LB+8YHwyGiYOAREZeWVUO41ASZFbe0dMP3tAFxQAAYAJADeMAC+M94L02qaRV7eoXPjw1BjAOT7-WNdcT0xu1WHu2MU1PSyCnIZrDRIwFSWUABW6jRa3QSpnMlmstgaDmazgg7g2gMCdxCESg+w8+1CAAoyghcLgECAxvgPGUyBAwDiEMB0LgKmNvPIAJRQaZlMzAVi4EQ4vEgXK-WgY0nkvFU3BMhAmVb-Ik+UKPObyIA)

`Join` å‹ã§ã¯ã€é…åˆ—ã®è¦ç´ ã”ã¨ã«å†å¸°çš„ã«æ–‡å­—åˆ—ã®çµåˆã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

`[infer P, ...infer R]` ã§å‚ç…§ã—ãŸé…åˆ—ã®æœ€åˆã®è¦ç´  `P` ã¨å¾Œç¶šã®è¦ç´  `R` ã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸæ–‡å­—åˆ—ã¨ã‚’ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿ `S` ã§çµåˆã—ã¦ã„ã¾ã™ã€‚

```ts
`${P}${S}${Join<R, S>}`
```

## String.prototype.split

JavaScript ã® `String.prototype.split` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã€å®Ÿè¡Œçµæœã®å‹æ¨è«–ãŒå¯èƒ½ãªé–¢æ•°ã¨ã—ã¦å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚

```ts
type Split<T extends string, S extends string> =
  T extends `${infer P}${S}${infer R}`
    ? string extends P
      ? [P]
      : [P, ...Split<R, S>]
    : [T];

function split<T extends string, S extends string>(
  value: T,
  separator: S
) {
  return value.split(separator) as Split<T, S>;
}
```

```ts
split('2020-05-15', '-'); // ts: ['2020', '05', '15']
split('Hello World', ''); // ts: ['H', 'e', 'l', 'l', 'o', ' ', 'W', 'o', 'r', 'l', 'd']
```

[Playground](https://www.typescriptlang.org/play?ts=4.1.0-beta#code/C4TwDgpgBAymA2BLYAeAKlCAPYEB2AJgM5RHABOieA5gDSyY77GkVXUB8UAvALABQUKBmy5CJAAYASAN5UAZhHJQACgF9ZMDXLyLlAJTUSBQoQH5WlGozEsVJ0+agBtFQF0HjgFwuV9AHSBcEio+vQwHB6Cpj7OaG4A3AIC8gCueADGwIgA9nikCMjoNswkZFZ0DKKlluwcABQOAG4AhvCpED5otA5EEGAt5C3AOeQ+MAIAlFAyDuQQwKnk+a3tEP5EhcD1fQNDI+TTLSTBRd2wHEn8asn8QA)

`Split` å‹ã§ã¯ã€Placeholder ã«ã‚ˆã‚‹ãƒãƒƒãƒãŒæœ€çŸ­ãƒãƒƒãƒã§ã‚ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¦ã€ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿ `P` ã§æŒ‡å®šã—ãŸæ–‡å­—åˆ—ã¾ã§ã®ãƒãƒ£ãƒ³ã‚¯ã‚’æŠœãå‡ºã—å†å¸°çš„ã«é…åˆ—ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```ts
  // ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿ P ã¾ã§ã®æ–‡å­—åˆ— P ã¨å¾Œç¶šã®ã™ã¹ã¦ã®æ–‡å­—åˆ— R
  T extends `${infer P}${S}${infer R}`
```

ç¶šã Conditional Types ã¯æŠœãå‡ºã—ãŸæ–‡å­—åˆ— `P` ãŒ `string` å‹ã§ã¯ãªã„ã‹ã‚’åˆ¤å®šã—ã¦ã„ã¾ã™ã€‚
`string extends P` ã¯æ–‡å­—åˆ— `P` ãŒ `string` å‹ã®å ´åˆ True ã«ã€æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã®å ´åˆ False ã«ãªã‚Šã¾ã™ã€‚
ã“ã®åˆ¤å®šã‚’å«ã‚ã¦ã„ã‚‹ç†ç”±ã¯ã€`P` ãŒ `string` å‹ã®å ´åˆã«ç„¡é™ãƒ«ãƒ¼ãƒ—ã—ã¦ã—ã¾ã‚ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã§ã™ã€‚

```ts
// NG
type Split<T extends string, S extends string> =
  T extends `${infer P}${S}${infer R}`
    // P ãŒ stringå‹ ã®å ´åˆã€å¸¸ã« True ã«ãªã‚‹ãŸã‚ç„¡é™ãƒ«ãƒ¼ãƒ—ãŒç™ºç”Ÿã™ã‚‹
    ? [P, ...Split<R, S>]
    // ts: Type instantiation is excessively deep and possibly infinite.
    : [T];
```
